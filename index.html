
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>What We're Reading</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  </head>
  <body>
    <div class="container">

      <div class="col-xs-10 col-xs-offset-1">
        <div class="pull-right" style="padding-top:1em;">
          <button class="btn btn-default" data-toggle="modal" data-target="#digest-modal">weekly digest</button>
          <a href="https://api.zotero.org/groups/520939/items/top?start=0&format=atom&v=1" class="btn btn-default" href=>subscribe to feed</a>
        </div>
        <h1>What We&rsquo;re Reading</h1>
        <h4>Rockefeller Archive Center&rsquo;s Digital Team</h4>
        <!-- Add disclaimer -->
        <div id="list"><img class="center-block" src="loading.gif" style="padding-top:5em;"></img></div>

        <div class="modal fade" id="digest-modal" tabindex="-1" role="dialog" aria-labelledby="digest-title" aria-hidden="true">
          <div class="modal-dialog modal-wide">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="digest-title">Readings from the last 7 days</h4>
              <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                      <div id="digest"></div>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>

    </div>
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script>
      var rssurl = "https://api.zotero.org/groups/520939/items/top?start=0&format=atom&v=1";
      $.get(rssurl, function(data) {
        var xml = $(data);
        $("#list").empty();
        $("#digest").empty();
        if (xml.find("entry").length) {
          xml.find("entry").each(function() {
            var date = new Date($(this).find("published").text());
            var now = new Date();
            var difference = now - date;
            item = {
                title: $(this).find("title").text().trim(),
                link: $(this).find("content").find("tr.url > td").text().trim().replace(/\/$/, ""),
                description: $(this).find("content").find("tr.abstractNote > td").text(),
                date: date.toDateString(),
                user: $(this).find("name").text(),
                id: $(this).find("id").text()
            }
            if(item.link.length > 1) {
              $("#list").append("<h3><a href=" + item.link + ">" + item.title + "</a> <small style='white-space:nowrap;'>" + item.date + "</small></h3><p>Added by " + item.user + "</p><p> " + item.description + "</p>");
            } else {
              $("#list").append("<h3><a href=" + item.id + ">" + item.title + "</a> <small style='white-space:nowrap;'>" + item.date + "</small></h3><p>Added by " + item.user + "</p><p> " + item.description + "</p>");
            }
            if(difference < 864000000) {
              if(item.link.length > 1) {
                $("#digest").append("<p>" + item.title + " - " + item.link + "</p>");
              } else {
                $("#digest").append("<p>" + item.title + " - " + item.id + "</p>");
              }
            }
          });
        } else {
          $("#list").append("<h3 class='text-center'>There's nothing here (yet)</h3><img class='center-block' src='loading.gif'>");
        }
      });
    </script>
  </body>
</html>
